# 项目名称：2023年春季CS307课程项目（第一部分）

## 主要贡献者、分工： 

12110416 刘家宝：ER图；建表语句

12112127 莫羡瑜：完善建表语句，导入数据

实验课时：周四三四节

贡献比：50%/50%

### 任务1：绘制E-R图

根据题目背景条件，我们可以画出如下ER图：

![image-20230417191150543](C:\Users\nian5\AppData\Roaming\Typora\typora-user-images\image-20230417191150543.png)



### 根据ER图模拟构建思路

   ###      主体

1. 作者（Author）
2. 文章（Post）
3. 评论（Reply）
4. 次级评论（Secondary Reply）

5. 分类（Category）
6. 城市（Posting City）

### 关系

在给定的 SQL 代码中，主体表之间存在以下一对多和多对多关系：

一对多关系：

1. 作者（Author）与文章（Post）：一个作者可以发布多篇文章，而每篇文章只能有一个作者。这里，作者表和文章表之间存在一对多关系。在文章表中，author_id 字段作为外键与作者表的 author_id 字段关联。
2. 文章（Post）与评论（Reply）：一篇文章可以有多个评论，而每个评论只能针对一篇文章。这里，文章表和评论表之间存在一对多关系。在评论表中，post_id 字段作为外键与文章表的 post_id 字段关联。
3. 评论（Reply）与次级评论（Secondary Reply）：一个评论可以有多个次级评论，而每个次级评论只能针对一个评论。这里，评论表和次级评论表之间存在一对多关系。在次级评论表中，reply_id 字段作为外键与评论表的 reply_id 字段关联。
4. 城市（Posting City）与文章（Post）：一个城市可以有多篇文章发布，而每篇文章只能发布在一个城市。这里，城市表和文章表之间存在一对多关系。在文章表中，posting_city 字段作为外键与城市表的 city_name 字段关联。

多对多关系：

1. 作者（Author）与关注的作者（Followed Author）：一个作者可以关注多个作者，同时也可以被多个作者关注。这里，作者表与关注表之间存在多对多关系。

   （关注表中的 author_id 和 follower_author_id 字段分别作为外键与作者表的 author_id 字段关联。）

2. 作者（Author）与收藏的文章（Favorite Post）：一个作者可以收藏多篇文章，同时一篇文章也可以被多个作者收藏。这里，作者表与收藏表之间存在多对多关系。

   （收藏表中的 favorite_author_id 字段作为外键与作者表的 author_id 字段关联，post_id 字段作为外键与文章表的 post_id 字段关联。）

3. 作者（Author）与分享的文章（Shared Post）：一个作者可以分享多篇文章，同时一篇文章也可以被多个作者分享。这里，作者表与分享表之间存在多对多关系。

   （分享表中的 sharing_author_id 字段作为外键与作者表的 author_id 字段关联，post_id 字段作为外键与文章表的 post_id 字段关联。）

4. 作者（Author）与点赞的文章（Liked Post）：一个作者可以点赞多篇文章，同时一篇文章也可以被多个作者点赞。这里，作者表与点赞表之间存在多对多关系。

   （点赞表中的 liking_author_id 字段作为外键与作者表的 author_id 字段关联，post_id 字段作为外键与文章表的 post_id 字段关联。）

5. 文章（Post）与分类（Category）：一篇文章可以属于多个分类，同时一个分类也可以包含多篇文章。这里，文章表与分类表之间存在多对多关系。

   （文章分类表（post_categories）作为关系表，其中 post_id 字段作为外键与文章表的 post_id 字段关联，category_id 字段作为外键与分类表的 category_id 字段关联。）

### 任务2：关系数据库设计

### Data Grip生成E-R图快照

根据任务一中分析，写出相应sql语句，由Data Grip生成的E-R图的快照如下：

![image-20230417191855678](C:\Users\nian5\AppData\Roaming\Typora\typora-user-images\image-20230417191855678.png)

### 每个表格和列的含义

下面简要描述表格设计及每个表格和列的含义。

主体表：

1. 作者表（authors）

   - author_id：作者的唯一标识符，主键。

   - author_name：作者的名字，不能为空且唯一。

   - registration_time：作者的注册时间，不能为空。

   - phone：作者的电话号码，唯一。

2. 文章表（posts）

   - post_id：文章的唯一标识符，主键。

   - author_id：与作者表关联的外键，表示文章作者的 ID。

   - title：文章的标题，不能为空。

   - content：文章的内容，不能为空。

   - posting_time：文章发布的时间，不能为空。

   - posting_city：文章发布的城市，与城市表关联的外键。

3. 评论表（replies）

   - reply_id：评论的唯一标识符，主键。

   - content：评论的内容，不能为空。

   - stars：评论的评分，不能为空。

   - author_id：与作者表关联的外键，表示评论作者的 ID。

   - post_id：与文章表关联的外键，表示被评论的文章的 ID。

4. 次级评论表（secondary_replies）

   - secondary_reply_id：次级评论的唯一标识符，主键。

   - content：次级评论的内容，不能为空。

   - stars：次级评论的评分，不能为空。

   - author_id：与作者表关联的外键，表示次级评论作者的 ID。

   - reply_id：与评论表关联的外键，表示被次级评论的评论的 ID。

5. 分类表（categories）

   - category_id：分类的唯一标识符，主键。

   - category_name：分类的名称，不能为空且唯一。

6. 城市表（cities）

   - city_name：城市的名称，主键。

   - city_state：城市所在的国家，不能为空。

关系表：

1. 关注表（followed_authors）

   - author_id：与作者表关联的外键，表示被关注的作者的 ID。

   - follower_author_id：关注者的作者 ID，不能为空。

   - 主键约束：(author_id, follower_author_id)

2. 收藏表（favorite_posts）

   - post_id：与文章表关联的外键，表示被收藏的文章的 ID。

   - favorite_author_id：收藏者的作者 ID，不能为空。

   - 主键约束：(post_id, favorite_author_id)

3. 分享表（shared_posts）

   - post_id：与文章表关联的外键，表示被分享的文章的 ID。

   - sharing_author_id：分享者的作者 ID，不能为空。

   - 主键约束：(post_id, sharing_author_id)

4. 点赞表（liked_posts）

   - post_id：与文章表关联的外键，表示被点赞的文章的 ID。

   - liking_author_id：点赞者的作者 ID，不能为空。

   - 主键约束：(post_id, liking_author_id)

5. 文章分类表（post_categories）

   - post_id：与文章表关联的外键，表示文章的 ID。

   - category_id：与分类表关联的外键，表示分类的 ID。

   - 主键约束：(post_id, category_id)

## 数据库设计注意事项：

1. 所有数据项应基于两个文件posts.json和replies.json。 √
2. 设计需遵循三个范式的要求。 √
3. 使用主键和外键表示关于数据的重要属性和关系。 √
4. 每个表中的每行应通过其主键唯一标识（可以使用简单或复合主键）。 √
5. 每个表都应涉及外键。不允许孤立表。 √
6. 设计中不能有循环外键链接。 √
7. 每个表应至少包含一个强制性（“Not Null”）列（包括主键但不包括id列）。 
8. 除系统生成的自增ID列外，应至少有一个带有“唯一”约束的列。 
9. 应为不同字段使用适当的数据类型。 √
10. 设计应在需求发生变化时易于扩展。 √

### 任务3：数据导入（占总分30%） 

在此任务中，您应编写脚本将这两个json文件的内容导入到先前设计的数据库中。导入数据后，还应确保所有数据已成功导入。

#### 任务3.1基本要求：10%

1. 编写的用于导入数据文件的脚本。
2. 关于如何使用脚本导入数据的描述。应清楚说明运行脚本并正确导入数据所需的步骤、必要的先决条件和注意事项。

#### 任务3.2高级要求：10% 

为获得剩余分数（10%），您可能还需要完成以下高级要求：

1. 尝试优化脚本，找到多种导入数据的方法，并对这些方法的计算效率进行比较分析。

对于高级分数，请务必描述测试环境、程序和实际时间成本。要求撰写一两段分析实验结果的文字。

#### 任务3.3数据准确性检查：10%

我们将在4月25日和27日的实验课上检查此部分。

1. 根据posts.json和replies.json中的数据，我们将在实验课上提出一些问题，以检查是否所有数据都已正确导入到数据库中。
2. 如果作者名称出现在以下字段中，但未出现在Author字段中，需要为作者帐户生成作者ID和合理的注册时间，并将其添加到数据库中。

报告提交方式 请在2023年4月24日23:30（北京时间，UTC+8）前将报告（PDF格式）及必要的附件（如SQL脚本和源代码文件）提交至Sakai网站。此外，请提交一个包含所有创建表的DDL（创建表语句）的SQL文件作为附件。请将其制作成一个单独的文件，而不是将语句复制粘贴到报告中。对于附件，请根据任务将它们放入单独的目录中，并将它们压缩成.zip文件。

